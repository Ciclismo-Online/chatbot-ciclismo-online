<!DOCTYPE html>
<html>
<head>
<base target="_top">
<title>Tu Gregario - Ciclismo Online</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* 1. Estilos RaÃ­z: CORRECCIÃ“N RESPONSIVE */
html, body {
Â  height: 100%;
Â  margin: 0;
Â  padding: 0;
Â  width: 100%;
Â  /* CLAVE: Quitamos overflow: hidden para permitir el scroll en mÃ³vil */
}

/* 2. Estilos Base */
body {
Â  font-family: 'Poppins', Arial, sans-serif;
Â  background-color: #1a1a2e;
Â  display: flex;
Â  justify-content: center;
Â  align-items: flex-start;
}

/* 3. Contenedor Principal (Flexbox) */
#main-wrapper {
Â  width: 100%;
Â  max-width: 700px;
Â  /* Usamos min-height 100vh para asegurar la altura completa de la ventana */
Â  min-height: 100vh;Â 
Â  display: flex;
Â  flex-direction: column;
Â  background-color: #24243e;
Â  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

/* == NUEVO: ESTILOS DEL ENCABEZADO == */
#chat-header {
Â  display: flex;
Â  align-items: center;
Â  padding: 10px 15px;
Â  background-color: #1a1a2e; /* Color de fondo oscuro */
Â  border-bottom: 1px solid #33334f; /* Borde sutil para separar */
Â  color: white;
}

#chat-header span {
Â  font-size: 24px; /* TamaÃ±o del icono */
Â  margin-right: 12px;
}

#chat-header h1 {
Â  font-size: 18px; /* TamaÃ±o del tÃ­tulo */
Â  font-weight: 600;
Â  margin: 0; /* Quitar margen por defecto del h1 */
}
/* ==================================== */

/* 4. Contenedor del Chat (Cuerpo del chat) */
#chat-container {
Â  flex-grow: 1;
Â  padding: 15px;
Â  overflow-y: scroll; /* El Ãºnico con scroll */
Â  display: flex;
Â  flex-direction: column;
Â  gap: 10px;
}

/* 5. Estilos de Mensajes (Bubble) */
.message {
Â  padding: 10px 15px;
Â  border-radius: 20px;
Â  max-width: 80%;
Â  word-wrap: break-word;
}
.user {
Â  background-color: #4e44b0;
Â  color: white;
Â  align-self: flex-end;
Â  border-bottom-right-radius: 5px;
}
.bot {
Â  background-color: #3f3f5f;
Â  color: #e0e0e0;
Â  align-self: flex-start;
Â  border-bottom-left-radius: 5px;
}
.bot strong {
Â  color: #ffcc00;
}

/* 6. Contenedor de Input */
#input-container {
Â  display: flex;
Â  padding: 10px;
Â  border-top: 1px solid #33334f;
Â  background-color: #24243e;
Â  position: sticky;
Â  bottom: 0;
}
#user-input {
Â  flex-grow: 1;
Â  padding: 10px 15px;
Â  border: none;
Â  border-radius: 25px;
Â  background-color: #33334f;
Â  color: white;
Â  font-size: 16px;
Â  margin-right: 10px;
Â  outline: none;
}
#send-button {
Â  background-color: #4e44b0;
Â  color: white;
Â  border: none;
Â  border-radius: 50%;
Â  width: 45px;
Â  height: 45px;
Â  display: flex;
Â  align-items: center;
Â  justify-content: center;
Â  cursor: pointer;
Â  transition: background-color 0.3s;
}
#send-button:hover:not(:disabled) {
Â  background-color: #6a5bcd;
}
#send-button:disabled {
Â  opacity: 0.5;
Â  cursor: not-allowed;
}

/* 7. Spinner de Carga */
.spinner {
Â  border: 4px solid rgba(255, 255, 255, 0.3);
Â  border-radius: 50%;
Â  border-top: 4px solid #ffcc00;
Â  width: 25px;
Â  height: 25px;
Â  -webkit-animation: spin 1s linear infinite;
Â  animation: spin 1s linear infinite;
Â  align-self: flex-start;
Â  margin: 10px 15px;
}

/* 8. Media Query para Responsive */
@media (max-width: 600px) {
Â  #main-wrapper {
Â  Â  box-shadow: none;
Â  }
}

/* 9. Keyframes para la animaciÃ³n del spinner */
@-webkit-keyframes spin {
Â  0% { -webkit-transform: rotate(0deg); }
Â  100% { -webkit-transform: rotate(360deg); }
}
@keyframes spin {
Â  0% { transform: rotate(0deg); }
Â  100% { transform: rotate(360deg); }
}

</style>
</head>
<body>

<div id="main-wrapper">

Â  <div id="chat-header">
Â  Â  <span>âš™ï¸</span>
Â  Â  <h1>Tu Gregario de Ciclismo Online</h1>
Â  </div>
Â  <div id="chat-container">
Â  </div>

Â  <div id="input-container">
Â  Â  <input type="text" id="user-input" placeholder="PregÃºntale a Tu Gregario..." autofocus>
Â  Â  <button id="send-button">
Â  Â  Â  <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="24" height="24">
Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.873L5.999 12zm0 0h7.5" />
Â  Â  Â  </svg>
Â  Â  </button>
Â  </div>
</div>

<script>
const userInput = document.getElementById('user-input');
const sendButton = document.getElementById('send-button');
const chatContainer = document.getElementById('chat-container');
let chatHistory = [];

function appendMessage(sender, message) {
Â  const messageElement = document.createElement('div');
Â  messageElement.classList.add('message', sender);
Â  messageElement.innerHTML = message;
Â  chatContainer.appendChild(messageElement);
Â  chatContainer.scrollTop = chatContainer.scrollHeight;
}

function sendMessage() {
Â  const message = userInput.value.trim();
Â  if (message === '') return;

Â  userInput.disabled = true;
Â  sendButton.disabled = true;

Â  appendMessage('user', message);
Â  chatHistory.push({ role: 'user', content: message });

Â  userInput.value = '';

Â  const spinner = document.createElement('div');
Â  spinner.classList.add('spinner');
Â  spinner.id = 'loading-spinner';
Â  chatContainer.appendChild(spinner);
Â  chatContainer.scrollTop = chatContainer.scrollHeight;

Â  // ğŸš€ URL DE LA WEB APP IMPLEMENTADA ğŸš€
Â  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby36KFWon8nSW0gD29W7iO5OGNSiK9AS4P672cvUWcifVcFXPIzHwr7y5nE5TRD_f6x/exec';

Â  fetch(WEB_APP_URL, {
Â  Â  method: 'POST',
Â  Â  headers: {
      // ğŸ‘‡ğŸ‘‡ğŸ‘‡ Â¡ESTA ES LA LÃNEA CORREGIDA! ğŸ‘‡ğŸ‘‡ğŸ‘‡
Â  Â  Â  'Content-Type': 'text/plain',
Â  Â  },
Â  Â  body: JSON.stringify({ chatHistory: chatHistory }),
Â  })
Â  .then(res => {
Â  Â  if (!res.ok) {
Â  Â  Â  throw new Error(`Error HTTP: ${res.status} (${res.statusText})`);
Â  Â  }
Â  Â  return res.json();
Â  })
Â  .then(data => {
Â  Â  const currentSpinner = document.getElementById('loading-spinner');
Â  Â  if (currentSpinner) {
Â  Â  Â  currentSpinner.remove();
Â  Â  }

Â  Â  if (data.success) {
Â  Â  Â  const response = data.responseText;
Â  Â  Â  appendMessage('bot', response);
Â  Â  Â  chatHistory.push({ role: 'assistant', content: response });
Â  Â  } else {
Â  Â  Â  appendMessage('bot', 'Disculpa, ha ocurrido un error en el servidor. ' + data.responseText);
Â  Â  Â  console.error('Error de Apps Script:', data.responseText);
Â  Â  }

Â  Â  userInput.disabled = false;
Â  Â  sendButton.disabled = false;
Â  Â  userInput.focus();
Â  })
Â  .catch(error => {
Â  Â  const currentSpinner = document.getElementById('loading-spinner');
Â  Â  if (currentSpinner) {
Â  Â  Â  currentSpinner.remove();
Â  Â  }
Â  Â  appendMessage('bot', 'Disculpa, ha ocurrido un error de conexiÃ³n con la API. Por favor, intÃ©ntalo de nuevo mÃ¡s tarde.');
Â  Â  console.error('Error de Fetch:', error);

Â  Â  userInput.disabled = false;
Â  Â  sendButton.disabled = false;
Â  Â  userInput.focus();
Â  });
}

// Event Listeners
sendButton.addEventListener('click', sendMessage);

userInput.addEventListener('keypress', function(e) {
Â  if (e.key === 'Enter') {
Â  Â  sendMessage();
Â  }
});

// MENSAJE DE BIENVENIDA AL CARGAR
document.addEventListener('DOMContentLoaded', function() {
Â  const welcomeMessage = "<strong>Â¡Hola! Soy Tu Gregario, tu asistente experto de Ciclismo Online.</strong> ğŸš´<br><br>Mi misiÃ³n es <strong>comparar precios y encontrarte la mejor oferta</strong> de productos (cascos, zapatillas, etc.) en nuestras tiendas <strong>afiliadas</strong>.<br><br><strong>Dime quÃ© buscas</strong> y te harÃ© unas preguntas rÃ¡pidas de talla y presupuesto.";
Â  appendMessage('bot', welcomeMessage);
Â  userInput.focus();
});

</script>
</body>
</html>
